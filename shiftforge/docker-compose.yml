# ============================================================
# ShiftForge — Docker Compose (PocketBase + Ollama)
# Completely free, self-hosted backend
# ============================================================

services:
  # ── PocketBase (Backend API + Auth + DB) ──────────────
  pocketbase:
    image: ghcr.io/muchobien/pocketbase:latest
    container_name: shiftforge-pb
    restart: unless-stopped
    ports:
      - "8090:8090"
    volumes:
      - pb_data:/pb/pb_data
      - ./backend/pocketbase/pb_schema.json:/pb/pb_schema.json:ro
      - ./backend/seed:/pb/seed:ro
    healthcheck:
      test: ["CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://localhost:8090/api/health"]
      interval: 30s
      timeout: 5s
      retries: 3
      start_period: 10s

  # ── Ollama (Self-hosted AI / LLM) ────────────────────
  ollama:
    image: ollama/ollama:latest
    container_name: shiftforge-ai
    restart: unless-stopped
    ports:
      - "11434:11434"
    volumes:
      - ollama_data:/root/.ollama
    # For GPU acceleration (optional, remove if no GPU):
    # deploy:
    #   resources:
    #     reservations:
    #       devices:
    #         - driver: nvidia
    #           count: 1
    #           capabilities: [gpu]
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:11434"]
      interval: 30s
      timeout: 5s
      retries: 3
      start_period: 30s

volumes:
  pb_data:
    driver: local
  ollama_data:
    driver: local
